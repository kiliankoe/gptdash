{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://gptdash.dev/protocol/v1/common.schema.json",
  "title": "GPTdash Common Types (v1)",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "version": { "const": "v1" }
  },
  "required": ["version"],
  "definitions": {
    "UUID": {
      "type": "string",
      "pattern": "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-5][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$"
    },
    "Phase": {
      "type": "string",
      "enum": [
        "Lobby",
        "PromptSet",
        "Answering",
        "Voting",
        "Reveal",
        "Scoreboard",
        "End"
      ]
    },
    "SessionConfig": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "provider": { "type": "string", "enum": ["openai", "ollama"] },
        "model": { "type": "string", "minLength": 1 },
        "roundCount": { "type": "integer", "minimum": 1, "maximum": 20 },
        "answerTime": { "type": "integer", "minimum": 10, "maximum": 600 },
        "voteTime": { "type": "integer", "minimum": 10, "maximum": 600 }
      },
      "required": ["provider", "model", "roundCount", "answerTime", "voteTime"]
    },
    "Player": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": { "$ref": "#/$defs/UUID" },
        "name": { "type": "string", "minLength": 1, "maxLength": 40 },
        "isHost": { "type": "boolean" },
        "joinedAt": { "type": "string", "format": "date-time" }
      },
      "required": ["id", "name", "isHost", "joinedAt"]
    },
    "Round": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": { "$ref": "#/$defs/UUID" },
        "index": { "type": "integer", "minimum": 1 },
        "prompt": { "type": "string", "minLength": 1, "maxLength": 400 },
        "aiSubmissionId": { "type": ["string", "null"] },
        "status": { "$ref": "#/$defs/Phase" }
      },
      "required": ["id", "index", "prompt", "status"]
    },
    "Submission": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": { "$ref": "#/$defs/UUID" },
        "playerId": { "$ref": "#/$defs/UUID" },
        "text": { "type": "string", "minLength": 1, "maxLength": 800 }
      },
      "required": ["id", "playerId", "text"]
    },
    "Vote": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": { "$ref": "#/$defs/UUID" },
        "voterId": { "$ref": "#/$defs/UUID" },
        "targetSubmissionId": { "$ref": "#/$defs/UUID" }
      },
      "required": ["id", "voterId", "targetSubmissionId"]
    },
    "Score": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "playerId": { "$ref": "#/$defs/UUID" },
        "points": { "type": "integer" }
      },
      "required": ["playerId", "points"]
    },
    "You": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "role": { "type": "string", "enum": ["host", "player"] },
        "playerId": { "$ref": "#/$defs/UUID" }
      },
      "required": ["role"]
    }
  }
}
